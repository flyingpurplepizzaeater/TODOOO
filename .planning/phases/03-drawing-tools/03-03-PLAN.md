---
phase: 03-drawing-tools
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - frontend/src/components/Canvas/uiOverrides.ts
  - frontend/src/components/Canvas/Canvas.tsx
autonomous: false

must_haves:
  truths:
    - "User can draw smooth freehand lines with pen tool"
    - "User can draw with marker/highlight tool (semi-transparent)"
    - "User can add rectangle, circle, line, and arrow shapes"
    - "User can erase strokes with eraser tool"
    - "Number keys 1-6 select corresponding tools"
    - "Default tool is select when opening canvas"
  artifacts:
    - path: "frontend/src/components/Canvas/uiOverrides.ts"
      provides: "Complete keyboard shortcuts for all drawing tools"
      contains: "highlight"
    - path: "frontend/src/components/Canvas/Canvas.tsx"
      provides: "Default tool set to select on mount"
      contains: "setCurrentTool.*select"
  key_links:
    - from: "frontend/src/components/Canvas/Canvas.tsx"
      to: "frontend/src/components/Canvas/uiOverrides.ts"
      via: "overrides prop"
      pattern: "overrides.*createUiOverrides"
---

<objective>
Complete keyboard shortcuts for all Phase 3 drawing tools and set default tool to select.

Purpose: Users need quick keyboard access to all tools (pen, marker, eraser, shapes). CONTEXT.md specifies default tool should be select for safe canvas opening.

Output: Extended uiOverrides.ts with shortcuts for highlight/marker, line, ellipse. Canvas.tsx sets default tool to select on mount.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-drawing-tools/03-RESEARCH.md
@frontend/src/components/Canvas/uiOverrides.ts
@frontend/src/components/Canvas/Canvas.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend uiOverrides with complete tool shortcuts</name>
  <files>frontend/src/components/Canvas/uiOverrides.ts</files>
  <action>
Update the tools() function in createUiOverrides to include all Phase 3 tools:

**Number key mapping (1-6):**
- 1 = select (already exists)
- 2 = draw/pen (already exists as '2,p')
- 3 = eraser (already exists as '3,e')
- 4 = arrow (already exists as '4,a')
- 5 = geo/rectangle (already exists as '5,r')
- 6 = highlight/marker (NEW)

**Additional shortcuts to add:**
```typescript
tools(_editor, tools): TLUiToolsContextType {
  return {
    ...tools,
    // Existing
    select: { ...tools.select, kbd: '1,v' },
    draw: { ...tools.draw, kbd: '2,p,d,b,x' },  // pen shortcuts
    eraser: { ...tools.eraser, kbd: '3,e' },
    arrow: { ...tools.arrow, kbd: '4,a' },
    geo: { ...tools.geo, kbd: '5,r' },

    // NEW for Phase 3
    highlight: { ...tools.highlight, kbd: '6,m,shift+d' },  // marker
    line: { ...tools.line, kbd: 'l' },                      // line tool
    // Note: ellipse/circle uses 'o' by default in tldraw
  }
}
```

**Shortcut rationale:**
- 6,m for marker (highlight) - 6 continues number sequence, m for marker
- shift+d for marker as alternative (d=draw, shift+d=highlight)
- l for line (tldraw default)
- o for ellipse/circle (tldraw default, already available)

Keep all existing shortcuts (undo, redo, zoom) intact.
  </action>
  <verify>
- uiOverrides.ts has highlight tool shortcut with '6,m,shift+d'
- uiOverrides.ts has line tool shortcut with 'l'
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>uiOverrides.ts has complete keyboard shortcuts for all Phase 3 tools</done>
</task>

<task type="auto">
  <name>Task 2: Set default tool to select on mount</name>
  <files>frontend/src/components/Canvas/Canvas.tsx</files>
  <action>
Update handleMount callback in Canvas.tsx to set default tool to select:

```typescript
const handleMount = useCallback((editor: Editor) => {
  editorRef.current = editor

  // Enable snap mode (grid + object snapping) per CONTEXT.md
  editor.user.updateUserPreferences({ isSnapMode: true })

  // Set default tool to select (safe default per CONTEXT.md)
  editor.setCurrentTool('select')
}, [])
```

This ensures:
- Canvas opens with select tool active (not draw or other tool)
- User must explicitly choose a drawing tool
- Prevents accidental drawing on canvas open
  </action>
  <verify>
- Canvas.tsx handleMount includes editor.setCurrentTool('select')
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>Canvas opens with select tool as default</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 3 drawing tools implementation:
- Custom stroke widths (~2/~6/~12px) via styleConfig.ts
- Custom color palette (13 colors) via styleConfig.ts
- Bottom-center toolbar via CustomToolbar.tsx
- Auto-hide with pin toggle
- Keyboard shortcuts for all tools (1-6, letters)
- Default select tool on mount
  </what-built>
  <how-to-verify>
1. Start the app: `cd frontend && npm run dev`
2. Open canvas in browser (http://localhost:5173 or similar)

**Verify toolbar position:**
- Toolbar should appear at bottom-center of screen
- Pin/unpin button visible

**Verify drawing tools:**
- Press 2 or p: Pen/draw tool active
- Press 6 or m: Marker/highlight tool active
- Press 3 or e: Eraser tool active
- Press 4 or a: Arrow tool active
- Press 5 or r: Rectangle/geo tool active
- Press l: Line tool active
- Press o: Ellipse/circle tool active
- Press 1 or v: Select tool active

**Verify styles:**
- Draw something, check stroke width options (should see thin/medium/thick)
- Check color palette (should see 13 colors: black, grey, white, blue, red, green, orange, yellow, violet, cyan, lime, pink, purple)

**Verify auto-hide:**
- Unpin toolbar if pinned
- Draw a stroke - toolbar should fade while drawing
- Release - toolbar should reappear
- Pin toolbar
- Draw a stroke - toolbar should stay visible

**Verify default tool:**
- Refresh page
- Confirm select tool is active (not draw)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit` passes
2. Dev server runs: `cd frontend && npm run dev` starts without errors
3. Human verification: All drawing tools work, styles apply, toolbar positioned correctly
</verification>

<success_criteria>
**DRAW-01:** User can draw freehand strokes with pen (draw tool) and marker (highlight tool)
**DRAW-02:** User can erase strokes with eraser tool (stroke-based)
**DRAW-03:** User can select from 13 colors (exceeds 8-12 requirement)
**DRAW-04:** User can select from 3-4 stroke widths (thin/medium/thick/xl)
**CANV-03:** User can add rectangle (geo), circle (ellipse), line, and arrow shapes

All Phase 3 requirements verifiable via human testing.
</success_criteria>

<output>
After completion, create `.planning/phases/03-drawing-tools/03-03-SUMMARY.md`
</output>
