---
phase: 03-drawing-tools
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/Canvas/CustomToolbar.tsx
  - frontend/src/components/Canvas/Canvas.tsx
autonomous: true

must_haves:
  truths:
    - "User sees toolbar at bottom center of canvas"
    - "User can draw freehand lines that appear instantly on canvas"
    - "User can add rectangle, circle, line, and arrow shapes via toolbar"
    - "User can erase specific strokes with eraser tool"
    - "User can toggle toolbar visibility (pin/auto-hide)"
  artifacts:
    - path: "frontend/src/components/Canvas/CustomToolbar.tsx"
      provides: "Bottom-center toolbar with auto-hide"
      exports: ["CustomToolbar", "toolbarComponents"]
    - path: "frontend/src/components/Canvas/Canvas.tsx"
      provides: "tldraw with custom toolbar"
      contains: "components={toolbarComponents}"
  key_links:
    - from: "frontend/src/components/Canvas/Canvas.tsx"
      to: "frontend/src/components/Canvas/CustomToolbar.tsx"
      via: "TLComponents prop"
      pattern: "components.*toolbarComponents"
    - from: "frontend/src/components/Canvas/CustomToolbar.tsx"
      to: "tldraw"
      via: "useEditor and DefaultToolbar"
      pattern: "useEditor|DefaultToolbar"
---

<objective>
Create custom toolbar component positioned at bottom-center with auto-hide functionality.

Purpose: CONTEXT.md specifies bottom-center toolbar for mobile thumb reach, with user-toggleable auto-hide option. Default tldraw toolbar is top-left which is not mobile-optimized.

Output: CustomToolbar.tsx with bottom-center positioning and pin/auto-hide toggle, wired into Canvas.tsx via TLComponents.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-drawing-tools/03-RESEARCH.md
@frontend/src/components/Canvas/Canvas.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CustomToolbar component with auto-hide</name>
  <files>frontend/src/components/Canvas/CustomToolbar.tsx</files>
  <action>
Create CustomToolbar.tsx with:

1. **Bottom-center positioning** using CSS:
   - position: fixed
   - bottom: 16px
   - left: 50%
   - transform: translateX(-50%)
   - z-index: 300 (above canvas, below connection indicator)

2. **Auto-hide behavior**:
   - State: `visible` (boolean), `pinned` (boolean)
   - When pinned=true: always visible
   - When pinned=false: hide during active drawing strokes
   - Use editor.store.listen() to detect drawing state
   - Listen to getCurrentToolId() and getIsPointerDown()
   - Hide when tool is 'draw', 'highlight', or 'eraser' AND pointer is down

3. **Pin toggle button**:
   - Small button next to toolbar
   - Icon or text indicating pin state (e.g., pin icon or "Pin"/"Unpin")
   - Clicking toggles pinned state

4. **Render DefaultToolbar** inside positioned container:
   ```typescript
   import { DefaultToolbar, useEditor, TLComponents } from 'tldraw'
   ```

5. **Export toolbarComponents** object for TLComponents prop:
   ```typescript
   export const toolbarComponents: TLComponents = {
     Toolbar: CustomToolbar,
   }
   ```

6. **Smooth transition** for hide/show:
   - opacity transition 0.2s
   - pointerEvents: 'none' when hidden to prevent accidental clicks

Do NOT use forceMobile prop - let tldraw handle responsive behavior within our positioned container.
  </action>
  <verify>
- File exists at frontend/src/components/Canvas/CustomToolbar.tsx
- Exports CustomToolbar and toolbarComponents
- Imports useEditor and DefaultToolbar from 'tldraw'
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>CustomToolbar.tsx exists with bottom-center positioning, auto-hide, and pin toggle</done>
</task>

<task type="auto">
  <name>Task 2: Wire CustomToolbar into Canvas component</name>
  <files>frontend/src/components/Canvas/Canvas.tsx</files>
  <action>
Update Canvas.tsx to use custom toolbar:

1. **Import toolbarComponents**:
   ```typescript
   import { toolbarComponents } from './CustomToolbar'
   ```

2. **Add components prop to Tldraw**:
   ```typescript
   <Tldraw
     store={store}
     cameraOptions={cameraOptions}
     overrides={overrides}
     components={toolbarComponents}
     onMount={handleMount}
     autoFocus
   />
   ```

3. **Keep existing functionality intact**:
   - ConnectionIndicator stays in top-right
   - UndoRedoIndicator stays in bottom-right (may need to adjust position to not overlap toolbar)
   - All existing hooks and handlers remain

4. **Optional: Adjust UndoRedoIndicator position** if it overlaps with bottom-center toolbar:
   - Move to bottom-right with slight offset from toolbar
   - Or move to top area near ConnectionIndicator
   - Use right: 8px, bottom: 70px to clear toolbar
  </action>
  <verify>
- Canvas.tsx imports toolbarComponents
- Tldraw has components={toolbarComponents} prop
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
- Dev server runs: `cd frontend && npm run dev`
  </verify>
  <done>Canvas.tsx renders tldraw with custom bottom-center toolbar</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit` passes
2. Dev server starts: `cd frontend && npm run dev` shows no errors
3. Toolbar position: Visual inspection shows toolbar at bottom-center
4. Auto-hide works: Toolbar hides while drawing (when not pinned)
5. Pin toggle works: Clicking pin keeps toolbar visible during drawing
</verification>

<success_criteria>
- CustomToolbar.tsx renders DefaultToolbar at bottom-center
- Auto-hide hides toolbar during active drawing strokes
- Pin button toggles auto-hide behavior
- Canvas.tsx uses toolbarComponents for Tldraw
- All existing Canvas functionality (connection indicator, undo/redo) still works
</success_criteria>

<output>
After completion, create `.planning/phases/03-drawing-tools/03-02-SUMMARY.md`
</output>
