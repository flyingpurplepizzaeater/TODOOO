---
phase: 08-mobile-platform
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/capacitor.config.ts
  - frontend/src/capacitor/platform.ts
autonomous: true

must_haves:
  truths:
    - "Capacitor is installed and configured for TODOOO app"
    - "iOS platform is added and builds without errors"
    - "Android platform is added and builds without errors"
  artifacts:
    - path: "frontend/package.json"
      provides: "Capacitor core and plugin dependencies"
      contains: "@capacitor/core"
    - path: "frontend/capacitor.config.ts"
      provides: "Capacitor configuration with TODOOO branding"
      contains: "appId: 'com.collabboard.todooo'"
    - path: "frontend/ios"
      provides: "iOS native project"
    - path: "frontend/android"
      provides: "Android native project"
    - path: "frontend/src/capacitor/platform.ts"
      provides: "Platform detection utilities"
      exports: ["isNativePlatform", "isMobileApp", "isIOS", "isAndroid"]
  key_links:
    - from: "frontend/capacitor.config.ts"
      to: "frontend/dist"
      via: "webDir configuration"
      pattern: "webDir.*dist"
---

<objective>
Initialize Capacitor for mobile app development with TODOOO branding.

Purpose: Establishes the mobile app foundation - all subsequent mobile plans depend on Capacitor being properly configured.

Output: Working Capacitor setup with iOS and Android platforms added, ready for native feature integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-mobile-platform/08-CONTEXT.md
@.planning/phases/08-mobile-platform/08-RESEARCH.md
@frontend/package.json
@frontend/vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Capacitor packages and initialize</name>
  <files>frontend/package.json, frontend/capacitor.config.ts</files>
  <action>
1. Install Capacitor core and all required plugins:
```bash
cd frontend
npm install @capacitor/core@6 @capacitor/app@6 @capacitor/camera@6 @capacitor/local-notifications@6 @capacitor/splash-screen@6 @capacitor/status-bar@6 @capacitor/filesystem@6 @capacitor/preferences@6
npm install -D @capacitor/cli@6
npm install @capacitor/ios@6 @capacitor/android@6
npm install @ionic/pwa-elements
```

2. Create `capacitor.config.ts` with TODOOO branding:
```typescript
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.collabboard.todooo',
  appName: 'TODOOO',
  webDir: 'dist',
  plugins: {
    SplashScreen: {
      launchShowDuration: 2000,
      launchAutoHide: false,  // Manual hide after app hydrates
      backgroundColor: '#14b8a6',  // Teal brand color
      showSpinner: false,
    },
    StatusBar: {
      style: 'DARK',
      backgroundColor: '#14b8a6',
    },
    LocalNotifications: {
      smallIcon: 'ic_stat_notification',
      iconColor: '#14b8a6',
    },
  },
};

export default config;
```

Key configuration notes:
- `webDir: 'dist'` matches Vite output
- `launchAutoHide: false` prevents white flash (manual hide after hydration)
- Teal (#14b8a6) brand color throughout
  </action>
  <verify>
- `npm ls @capacitor/core` shows version 6.x installed
- `frontend/capacitor.config.ts` exists with correct appId
- `cat frontend/package.json | grep capacitor` shows all plugins
  </verify>
  <done>Capacitor packages installed and configuration file created with TODOOO branding</done>
</task>

<task type="auto">
  <name>Task 2: Add iOS and Android platforms</name>
  <files>frontend/ios, frontend/android</files>
  <action>
1. Build web assets first (required before adding platforms):
```bash
cd frontend
npm run build
```

2. Add iOS platform:
```bash
npx cap add ios
```

3. Add Android platform:
```bash
npx cap add android
```

4. Sync web assets to native projects:
```bash
npx cap sync
```

5. Add npm scripts for Capacitor workflow to package.json:
```json
{
  "scripts": {
    "cap:sync": "npm run build && npx cap sync",
    "cap:ios": "npm run build && npx cap sync ios && npx cap open ios",
    "cap:android": "npm run build && npx cap sync android && npx cap open android"
  }
}
```

6. Add ios/ and android/ to .gitignore (optional but recommended for CI):
```
# Native platforms (generated by Capacitor)
# Uncomment if you want to regenerate on each CI run
# ios/
# android/
```
  </action>
  <verify>
- `ls frontend/ios` shows iOS project files (App.xcworkspace)
- `ls frontend/android` shows Android project files (app/, gradle/)
- `npm run cap:sync` completes without errors
  </verify>
  <done>iOS and Android platforms added, sync works</done>
</task>

<task type="auto">
  <name>Task 3: Create platform detection utilities</name>
  <files>frontend/src/capacitor/platform.ts</files>
  <action>
Create `frontend/src/capacitor/platform.ts`:

```typescript
/**
 * Platform detection utilities for Capacitor mobile apps.
 *
 * Use these helpers to conditionally enable mobile-specific features
 * or adjust behavior based on platform.
 */
import { Capacitor } from '@capacitor/core';

/**
 * Returns true if running inside a native Capacitor app (iOS or Android).
 * Returns false for web browser, including mobile browsers.
 */
export function isNativePlatform(): boolean {
  return Capacitor.isNativePlatform();
}

/**
 * Returns true if the platform is iOS (native app).
 */
export function isIOS(): boolean {
  return Capacitor.getPlatform() === 'ios';
}

/**
 * Returns true if the platform is Android (native app).
 */
export function isAndroid(): boolean {
  return Capacitor.getPlatform() === 'android';
}

/**
 * Returns true if running on a mobile device (native app OR mobile browser).
 * Uses touch capability as fallback for mobile browser detection.
 */
export function isMobileDevice(): boolean {
  if (isNativePlatform()) return true;
  return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
}

/**
 * Alias for isNativePlatform - clearer name for mobile app checks.
 */
export const isMobileApp = isNativePlatform;

/**
 * Returns the current platform name: 'ios', 'android', or 'web'.
 */
export function getPlatformName(): 'ios' | 'android' | 'web' {
  return Capacitor.getPlatform() as 'ios' | 'android' | 'web';
}
```

Create barrel export `frontend/src/capacitor/index.ts`:
```typescript
export * from './platform';
```
  </action>
  <verify>
- `cat frontend/src/capacitor/platform.ts` shows platform detection functions
- `cat frontend/src/capacitor/index.ts` exports platform module
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>Platform detection utilities created and exported</done>
</task>

</tasks>

<verification>
1. `npm ls @capacitor/core` shows version 6.x
2. `ls frontend/ios` and `ls frontend/android` show native project directories
3. `npm run cap:sync` completes successfully
4. TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`
</verification>

<success_criteria>
- Capacitor 6.x installed with all required plugins
- capacitor.config.ts exists with TODOOO branding (teal color, proper appId)
- iOS platform added (ios/ directory with Xcode project)
- Android platform added (android/ directory with Gradle project)
- Platform detection utilities available for feature gating
- npm scripts added for Capacitor workflow
</success_criteria>

<output>
After completion, create `.planning/phases/08-mobile-platform/08-01-SUMMARY.md`
</output>
