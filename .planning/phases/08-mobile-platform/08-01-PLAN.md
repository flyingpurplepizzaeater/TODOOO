---
phase: 08-mobile-platform
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/capacitor.config.ts
  - frontend/src/capacitor/platform.ts
  - frontend/src/capacitor/splash.ts
  - frontend/src/components/SplashAnimation.tsx
  - frontend/src/main.tsx
autonomous: true

must_haves:
  truths:
    - "Capacitor is installed and configured for TODOOO app"
    - "iOS platform is added and builds without errors"
    - "Android platform is added and builds without errors"
    - "Animated splash screen shows checkmark animation on app launch"
  artifacts:
    - path: "frontend/package.json"
      provides: "Capacitor core and plugin dependencies"
      contains: "@capacitor/core"
    - path: "frontend/capacitor.config.ts"
      provides: "Capacitor configuration with TODOOO branding"
      contains: "appId: 'com.collabboard.todooo'"
    - path: "frontend/ios"
      provides: "iOS native project"
    - path: "frontend/android"
      provides: "Android native project"
    - path: "frontend/src/capacitor/platform.ts"
      provides: "Platform detection utilities"
      exports: ["isNativePlatform", "isMobileApp", "isIOS", "isAndroid"]
    - path: "frontend/src/capacitor/splash.ts"
      provides: "Splash screen controller"
      exports: ["hideSplash"]
    - path: "frontend/src/components/SplashAnimation.tsx"
      provides: "Web-based animated splash overlay"
      exports: ["SplashAnimation"]
  key_links:
    - from: "frontend/capacitor.config.ts"
      to: "frontend/dist"
      via: "webDir configuration"
      pattern: "webDir.*dist"
    - from: "frontend/src/main.tsx"
      to: "frontend/src/components/SplashAnimation.tsx"
      via: "SplashAnimation render"
      pattern: "SplashAnimation"
---

<objective>
Initialize Capacitor for mobile app development with TODOOO branding and animated splash screen.

Purpose: Establishes the mobile app foundation - all subsequent mobile plans depend on Capacitor being properly configured. Includes animated splash per CONTEXT.md requirements.

Output: Working Capacitor setup with iOS and Android platforms added, animated splash screen, ready for native feature integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-mobile-platform/08-CONTEXT.md
@.planning/phases/08-mobile-platform/08-RESEARCH.md
@frontend/package.json
@frontend/vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Capacitor packages and initialize</name>
  <files>frontend/package.json, frontend/capacitor.config.ts</files>
  <action>
1. Install Capacitor core and all required plugins:
```bash
cd frontend
npm install @capacitor/core@6 @capacitor/app@6 @capacitor/camera@6 @capacitor/local-notifications@6 @capacitor/splash-screen@6 @capacitor/status-bar@6 @capacitor/filesystem@6 @capacitor/preferences@6
npm install -D @capacitor/cli@6
npm install @capacitor/ios@6 @capacitor/android@6
npm install @ionic/pwa-elements
```

2. Create `capacitor.config.ts` with TODOOO branding:
```typescript
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.collabboard.todooo',
  appName: 'TODOOO',
  webDir: 'dist',
  plugins: {
    SplashScreen: {
      launchShowDuration: 0,        // Hide native splash immediately
      launchAutoHide: false,        // Manual hide after web animation
      backgroundColor: '#14b8a6',   // Teal brand color
      showSpinner: false,
    },
    StatusBar: {
      style: 'DARK',
      backgroundColor: '#14b8a6',
    },
    LocalNotifications: {
      smallIcon: 'ic_stat_notification',
      iconColor: '#14b8a6',
    },
  },
};

export default config;
```

Key configuration notes:
- `webDir: 'dist'` matches Vite output
- `launchShowDuration: 0` + `launchAutoHide: false` = native splash hidden immediately, web animation takes over
- This approach avoids white flash by keeping teal background while web loads
- Teal (#14b8a6) brand color throughout
  </action>
  <verify>
- `npm ls @capacitor/core` shows version 6.x installed
- `frontend/capacitor.config.ts` exists with correct appId
- `cat frontend/package.json | grep capacitor` shows all plugins
  </verify>
  <done>Capacitor packages installed and configuration file created with TODOOO branding</done>
</task>

<task type="auto">
  <name>Task 2: Add iOS and Android platforms</name>
  <files>frontend/ios, frontend/android</files>
  <action>
1. Build web assets first (required before adding platforms):
```bash
cd frontend
npm run build
```

2. Add iOS platform:
```bash
npx cap add ios
```

3. Add Android platform:
```bash
npx cap add android
```

4. Sync web assets to native projects:
```bash
npx cap sync
```

5. Add npm scripts for Capacitor workflow to package.json:
```json
{
  "scripts": {
    "cap:sync": "npm run build && npx cap sync",
    "cap:ios": "npm run build && npx cap sync ios && npx cap open ios",
    "cap:android": "npm run build && npx cap sync android && npx cap open android"
  }
}
```

6. Add ios/ and android/ to .gitignore (optional but recommended for CI):
```
# Native platforms (generated by Capacitor)
# Uncomment if you want to regenerate on each CI run
# ios/
# android/
```
  </action>
  <verify>
- `ls frontend/ios` shows iOS project files (App.xcworkspace)
- `ls frontend/android` shows Android project files (app/, gradle/)
- `npm run cap:sync` completes without errors
  </verify>
  <done>iOS and Android platforms added, sync works</done>
</task>

<task type="auto">
  <name>Task 3: Create platform detection utilities and animated splash screen</name>
  <files>frontend/src/capacitor/platform.ts, frontend/src/capacitor/splash.ts, frontend/src/components/SplashAnimation.tsx, frontend/src/main.tsx, frontend/src/capacitor/index.ts</files>
  <action>
1. Create `frontend/src/capacitor/platform.ts`:

```typescript
/**
 * Platform detection utilities for Capacitor mobile apps.
 *
 * Use these helpers to conditionally enable mobile-specific features
 * or adjust behavior based on platform.
 */
import { Capacitor } from '@capacitor/core';

/**
 * Returns true if running inside a native Capacitor app (iOS or Android).
 * Returns false for web browser, including mobile browsers.
 */
export function isNativePlatform(): boolean {
  return Capacitor.isNativePlatform();
}

/**
 * Returns true if the platform is iOS (native app).
 */
export function isIOS(): boolean {
  return Capacitor.getPlatform() === 'ios';
}

/**
 * Returns true if the platform is Android (native app).
 */
export function isAndroid(): boolean {
  return Capacitor.getPlatform() === 'android';
}

/**
 * Returns true if running on a mobile device (native app OR mobile browser).
 * Uses touch capability as fallback for mobile browser detection.
 */
export function isMobileDevice(): boolean {
  if (isNativePlatform()) return true;
  return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
}

/**
 * Alias for isNativePlatform - clearer name for mobile app checks.
 */
export const isMobileApp = isNativePlatform;

/**
 * Returns the current platform name: 'ios', 'android', or 'web'.
 */
export function getPlatformName(): 'ios' | 'android' | 'web' {
  return Capacitor.getPlatform() as 'ios' | 'android' | 'web';
}
```

2. Create `frontend/src/capacitor/splash.ts`:

```typescript
/**
 * Splash screen controller.
 *
 * CONTEXT.md requirements:
 * - Splash screen: Animated loading animation (brief, e.g., checkmark drawing)
 *
 * Implementation approach per RESEARCH.md:
 * - Native splash hides immediately (launchShowDuration: 0)
 * - Web-based animation shows on top
 * - Animation completes, then hides
 *
 * This avoids fighting native splash limitations and provides
 * smooth animated experience on both platforms.
 */
import { SplashScreen } from '@capacitor/splash-screen';
import { isNativePlatform } from './platform';

/**
 * Hide the native splash screen.
 * Call this after web animation completes.
 */
export async function hideSplash(): Promise<void> {
  if (isNativePlatform()) {
    await SplashScreen.hide();
  }
}

/**
 * Show the native splash screen (rarely needed).
 */
export async function showSplash(): Promise<void> {
  if (isNativePlatform()) {
    await SplashScreen.show();
  }
}
```

3. Create `frontend/src/components/SplashAnimation.tsx`:

```typescript
/**
 * Animated splash screen overlay.
 *
 * CONTEXT.md: "Animated loading animation (brief, e.g., checkmark drawing)"
 *
 * Shows on app launch, animates checkmark, then fades out.
 * Only renders on native platforms (web doesn't need splash).
 */
import { useEffect, useState } from 'react';
import { hideSplash, isNativePlatform } from '../capacitor';

interface SplashAnimationProps {
  onComplete?: () => void;
}

export function SplashAnimation({ onComplete }: SplashAnimationProps) {
  const [phase, setPhase] = useState<'drawing' | 'holding' | 'fading' | 'done'>('drawing');

  useEffect(() => {
    // Only animate on native platforms
    if (!isNativePlatform()) {
      setPhase('done');
      onComplete?.();
      return;
    }

    // Animation timeline:
    // 0-600ms: checkmark draws
    // 600-1000ms: hold
    // 1000-1300ms: fade out
    const drawTimer = setTimeout(() => setPhase('holding'), 600);
    const holdTimer = setTimeout(() => setPhase('fading'), 1000);
    const doneTimer = setTimeout(() => {
      setPhase('done');
      hideSplash();
      onComplete?.();
    }, 1300);

    return () => {
      clearTimeout(drawTimer);
      clearTimeout(holdTimer);
      clearTimeout(doneTimer);
    };
  }, [onComplete]);

  // Don't render anything once done
  if (phase === 'done') return null;

  return (
    <div
      style={{
        position: 'fixed',
        inset: 0,
        zIndex: 9999,
        backgroundColor: '#14b8a6',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        opacity: phase === 'fading' ? 0 : 1,
        transition: 'opacity 300ms ease-out',
      }}
    >
      {/* Animated checkmark */}
      <svg
        width="120"
        height="120"
        viewBox="0 0 120 120"
        fill="none"
        style={{ filter: 'drop-shadow(0 4px 8px rgba(0,0,0,0.15))' }}
      >
        {/* Circle background */}
        <circle
          cx="60"
          cy="60"
          r="50"
          fill="white"
          opacity="0.95"
        />
        {/* Animated checkmark path */}
        <path
          d="M35 60 L52 77 L85 44"
          stroke="#14b8a6"
          strokeWidth="8"
          strokeLinecap="round"
          strokeLinejoin="round"
          fill="none"
          style={{
            strokeDasharray: 100,
            strokeDashoffset: phase === 'drawing' ? 100 : 0,
            transition: 'stroke-dashoffset 500ms ease-out',
          }}
        />
      </svg>
      {/* App name below checkmark */}
      <div
        style={{
          position: 'absolute',
          bottom: '25%',
          color: 'white',
          fontSize: 28,
          fontWeight: 700,
          letterSpacing: 2,
          opacity: phase === 'drawing' ? 0 : 1,
          transform: phase === 'drawing' ? 'translateY(10px)' : 'translateY(0)',
          transition: 'opacity 300ms ease-out, transform 300ms ease-out',
        }}
      >
        TODOOO
      </div>
    </div>
  );
}
```

4. Update `frontend/src/main.tsx` to include splash animation:

Add import at top:
```typescript
import { SplashAnimation } from './components/SplashAnimation';
import { defineCustomElements } from '@ionic/pwa-elements/loader';
```

Add PWA elements initialization:
```typescript
// Initialize PWA elements for web camera fallback
if (typeof window !== 'undefined') {
  defineCustomElements(window);
}
```

Wrap the root render to include SplashAnimation:
```typescript
// Modify the render to include splash
const root = ReactDOM.createRoot(document.getElementById('root')!);
root.render(
  <React.StrictMode>
    <SplashAnimation />
    <App />
  </React.StrictMode>
);
```

Or if using a different pattern, ensure SplashAnimation renders above the app initially.

5. Create barrel export `frontend/src/capacitor/index.ts`:
```typescript
export * from './platform';
export * from './splash';
```
  </action>
  <verify>
- `cat frontend/src/capacitor/platform.ts` shows platform detection functions
- `cat frontend/src/capacitor/splash.ts` shows hideSplash function
- `cat frontend/src/components/SplashAnimation.tsx` shows animated checkmark component
- `cat frontend/src/capacitor/index.ts` exports platform and splash modules
- `grep "SplashAnimation" frontend/src/main.tsx` shows component usage
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>Platform detection utilities and animated splash screen created</done>
</task>

</tasks>

<verification>
1. `npm ls @capacitor/core` shows version 6.x
2. `ls frontend/ios` and `ls frontend/android` show native project directories
3. `npm run cap:sync` completes successfully
4. TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`
5. SplashAnimation component exists with checkmark animation
</verification>

<success_criteria>
- Capacitor 6.x installed with all required plugins
- capacitor.config.ts exists with TODOOO branding (teal color, proper appId)
- iOS platform added (ios/ directory with Xcode project)
- Android platform added (android/ directory with Gradle project)
- Platform detection utilities available for feature gating
- Animated splash screen with checkmark drawing animation
- npm scripts added for Capacitor workflow
</success_criteria>

<output>
After completion, create `.planning/phases/08-mobile-platform/08-01-SUMMARY.md`
</output>
