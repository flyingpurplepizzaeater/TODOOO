---
phase: 05-todo-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/Canvas/shapes/todo/types.ts
  - frontend/src/components/Canvas/shapes/todo/TodoCard.tsx
  - frontend/src/components/Canvas/shapes/todo/TodoShapeUtil.tsx
  - frontend/src/components/Canvas/shapes/todo/TodoTool.ts
  - frontend/src/components/Canvas/shapes/todo/index.ts
  - frontend/src/components/Canvas/shapes/index.ts
  - frontend/src/components/Canvas/Canvas.tsx
  - frontend/src/components/Canvas/CustomToolbar.tsx
  - frontend/src/components/Canvas/uiOverrides.ts
  - frontend/package.json
autonomous: true

must_haves:
  truths:
    - "User can add TODO card to canvas via toolbar"
    - "TODO card displays title, checkbox, due date, assignee"
    - "Clicking checkbox toggles completed state"
    - "Completed tasks show green tint + checkmark + strikethrough"
    - "Overdue tasks show red due date + red border"
    - "Priority shows as colored left border (red/yellow/blue)"
  artifacts:
    - path: "frontend/src/components/Canvas/shapes/todo/types.ts"
      provides: "TodoShape type definition"
      contains: "TLBaseShape"
    - path: "frontend/src/components/Canvas/shapes/todo/TodoShapeUtil.tsx"
      provides: "Custom shape utility"
      contains: "BaseBoxShapeUtil"
    - path: "frontend/src/components/Canvas/shapes/todo/TodoCard.tsx"
      provides: "Visual card component"
      contains: "priorityColors"
    - path: "frontend/src/components/Canvas/shapes/todo/TodoTool.ts"
      provides: "Tool for creating TODOs"
      contains: "StateNode"
  key_links:
    - from: "frontend/src/components/Canvas/Canvas.tsx"
      to: "TodoShapeUtil"
      via: "shapeUtils prop"
      pattern: "shapeUtils.*TodoShapeUtil"
    - from: "frontend/src/components/Canvas/CustomToolbar.tsx"
      to: "todo tool"
      via: "tool button"
      pattern: "setCurrentTool.*todo"
---

<objective>
Create custom TODO shape type for tldraw canvas with full visual styling per CONTEXT.md requirements.

Purpose: Enable users to add TODO cards to canvas with title, status checkbox, due date, assignee, and priority visualization. This is the foundation for visual task management on the canvas.

Output: TodoShapeUtil custom shape, TodoCard visual component, TodoTool for creation, toolbar integration with keyboard shortcut.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-todo-integration/05-CONTEXT.md
@.planning/phases/05-todo-integration/05-RESEARCH.md
@frontend/src/components/Canvas/Canvas.tsx
@frontend/src/components/Canvas/CustomToolbar.tsx
@frontend/src/components/Canvas/uiOverrides.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install date-fns and create TODO shape types</name>
  <files>
    frontend/package.json
    frontend/src/components/Canvas/shapes/todo/types.ts
  </files>
  <action>
1. Install date-fns for date formatting:
   ```bash
   cd frontend && npm install date-fns
   ```

2. Create `frontend/src/components/Canvas/shapes/todo/types.ts`:
   - Define TodoShape type extending TLBaseShape with type 'todo'
   - Props:
     - w: number (default 280)
     - h: number (default 100)
     - title: string (default 'New Task')
     - completed: boolean (default false)
     - dueDate: string | null (ISO date, default null)
     - assigneeId: number | null (default null)
     - assigneeName: string | null (default null)
     - priority: 'high' | 'medium' | 'low' (default 'medium')
     - backendId: number | null (for backend sync, default null)
     - listId: number | null (for backend sync, default null)

Use pattern from RESEARCH.md with T validators for each prop.
  </action>
  <verify>
- `npm ls date-fns` shows version installed
- File exists at `frontend/src/components/Canvas/shapes/todo/types.ts`
- Contains TLBaseShape, T validators for all props
  </verify>
  <done>
TodoShape type defined with all required properties and validators.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TodoCard visual component</name>
  <files>
    frontend/src/components/Canvas/shapes/todo/TodoCard.tsx
  </files>
  <action>
Create React component for TODO card visual rendering:

1. Interface TodoCardProps:
   - shape: TodoShape
   - isEditing: boolean
   - isOverdue: boolean
   - onToggleComplete: () => void
   - onTitleChange: (title: string) => void

2. Priority colors object:
   - high: '#ef4444' (red)
   - medium: '#f59e0b' (amber/yellow)
   - low: '#3b82f6' (blue)

3. Card styling (per CONTEXT.md):
   - Background: completed ? '#dcfce7' (green tint) : '#ffffff'
   - Border: 2px solid, red (#ef4444) if overdue, gray (#e5e7eb) otherwise
   - Left border: 4px solid priority color
   - Border radius: 8px
   - Padding: 12px
   - Box shadow: subtle drop shadow

4. Header row layout:
   - Checkbox (18x18px) left-aligned
   - Title with contentEditable when isEditing
   - Title styling: completed -> line-through + gray, normal -> no decoration + dark

5. Footer row layout:
   - Due date (format: "MMM d" using date-fns format())
   - Due date color: red if overdue, gray otherwise
   - Assignee name in pill/badge style

Use format() from date-fns for date display.
  </action>
  <verify>
- File exists at `frontend/src/components/Canvas/shapes/todo/TodoCard.tsx`
- Contains priorityColors with red/amber/blue
- Contains checkbox input element
- Uses contentEditable for title editing
- Uses date-fns format for due date display
  </verify>
  <done>
TodoCard component renders full card UI with checkbox, title, due date, assignee, and priority/status visualization.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create TodoShapeUtil and TodoTool</name>
  <files>
    frontend/src/components/Canvas/shapes/todo/TodoShapeUtil.tsx
    frontend/src/components/Canvas/shapes/todo/TodoTool.ts
    frontend/src/components/Canvas/shapes/todo/index.ts
    frontend/src/components/Canvas/shapes/index.ts
  </files>
  <action>
1. Create TodoShapeUtil (`TodoShapeUtil.tsx`):
   - Extend BaseBoxShapeUtil<TodoShape>
   - static type = 'todo' as const
   - static props using T validators from types.ts
   - getDefaultProps() returning defaults
   - canEdit() returns true (for title editing)
   - canResize() returns true
   - isAspectRatioLocked() returns false (freely resizable per CONTEXT.md)
   - onResize() using resizeBox()
   - component() method:
     - Get isEditing from editor.getEditingShapeId() === shape.id
     - Calculate isOverdue using isPast() and isToday() from date-fns
     - Wrap TodoCard in HTMLContainer with pointerEvents logic
     - Wire onToggleComplete to editor.updateShape
     - Wire onTitleChange to editor.updateShape
   - indicator() method returning rect with rx={8}

2. Create TodoTool (`TodoTool.ts`):
   - Extend StateNode
   - static id = 'todo'
   - onEnter(): set cursor to 'cross'
   - onPointerDown(): create todo shape at pointer position using editor.createShape()
   - After creation, set current tool back to 'select'

3. Create barrel exports:
   - `shapes/todo/index.ts`: export TodoShapeUtil, TodoTool, TodoShape
   - `shapes/index.ts`: re-export from todo/

Reference RESEARCH.md Pattern 1 for TodoShapeUtil structure.
  </action>
  <verify>
- TodoShapeUtil.tsx exists and extends BaseBoxShapeUtil
- TodoTool.ts exists and extends StateNode
- Both index.ts barrel files export correctly
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
TodoShapeUtil handles shape behavior, TodoTool handles creation interaction, exports wired up.
  </done>
</task>

<task type="auto">
  <name>Task 4: Register shape and add toolbar/keyboard integration</name>
  <files>
    frontend/src/components/Canvas/Canvas.tsx
    frontend/src/components/Canvas/CustomToolbar.tsx
    frontend/src/components/Canvas/uiOverrides.ts
  </files>
  <action>
1. Update Canvas.tsx:
   - Import TodoShapeUtil and TodoTool from './shapes/todo'
   - Create customShapeUtils array OUTSIDE component: `const customShapeUtils = [TodoShapeUtil]`
   - Create customTools array OUTSIDE component: `const customTools = [TodoTool]`
   - Pass shapeUtils={customShapeUtils} to Tldraw
   - Pass tools={customTools} to Tldraw

2. Update CustomToolbar.tsx:
   - Add TODO tool button (use checkmark/task icon or text "TODO")
   - Position in toolbar alongside existing tools
   - onClick: editor.setCurrentTool('todo')
   - Show active state when current tool is 'todo'

3. Update uiOverrides.ts:
   - Add keyboard shortcut '7' or 'T' for todo tool
   - In tools() function, add: 'todo': { kbd: 't' } or similar
   - Ensure it follows existing pattern (select=1, draw=2, etc.)

Keyboard recommendation: Use 'T' for TODO (mnemonic).
  </action>
  <verify>
- Canvas.tsx has shapeUtils prop with TodoShapeUtil
- Canvas.tsx has tools prop with TodoTool
- CustomToolbar.tsx has TODO button that calls setCurrentTool('todo')
- uiOverrides.ts has 't' keyboard shortcut for todo
- TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
TODO shape registered with tldraw, toolbar button added, keyboard shortcut 'T' works.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. TypeScript compilation:
   ```bash
   cd frontend && npx tsc --noEmit
   ```
   Should pass with no errors (pre-existing Y.js errors in useYjsStore.ts may remain)

2. File structure check:
   ```bash
   ls frontend/src/components/Canvas/shapes/todo/
   ```
   Should show: types.ts, TodoCard.tsx, TodoShapeUtil.tsx, TodoTool.ts, index.ts

3. Imports verification:
   - Canvas.tsx imports and uses TodoShapeUtil, TodoTool
   - CustomToolbar.tsx has todo tool button
   - uiOverrides.ts has todo keyboard shortcut
</verification>

<success_criteria>
1. Custom TodoShape type defined with all required props (title, completed, dueDate, assigneeId, assigneeName, priority, backendId, listId)
2. TodoCard component renders checkbox, title, due date, assignee with proper styling
3. Completed state shows green background + strikethrough
4. Overdue state shows red date text + red border
5. Priority shows as colored left border (red/amber/blue)
6. TodoShapeUtil registered with tldraw and functional
7. TODO tool creates cards at click position
8. Toolbar has TODO button
9. Keyboard shortcut 'T' activates TODO tool
10. All TypeScript compiles without new errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-todo-integration/05-01-SUMMARY.md`
</output>
